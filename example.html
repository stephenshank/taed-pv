<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">

    <title>Basic viewer</title>
    <meta name="description" content="The HTML5 Herald">
    <meta name="author" content="SitePoint">
    <script type='text/javascript' src='pv/bio-pv.min.js'></script>
</head>

<body>
    <span id="changes"></span>
    <div id='viewer'></div>
    <script type="text/javascript">
        var options = {
          width: 750,
          height: 750,
          antialias: true,
          quality : 'medium',
          background: '#EEE'
        };

        // 1ZAK_A... working
        var pdb_file = 'pdbs/1ZAK.pdb';
        var magic_number = 3;
//        var annotations = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,2,2,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,2,0,0,0,0,0,0];
        var annotations = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2];
        var indices = [100, 200, 300, 400, 500, 600, 700, 800]
        
        // 2FH7_A... no backbone
//        var pdb_file = 'pdbs/2FH7.pdb';
//        // random colors, which don't work
//        var annotations = [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 1, 0, 1, 2, 1, 1, 0, 0, 1, 1, 0, 0, 2, 0, 2, 1, 2, 0, 1, 2, 2, 1, 0, 2, 0, 2, 1, 1, 2, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 1, 1, 1, 1, 2, 0, 2, 2, 1, 2, 0, 2, 1, 2, 1, 2, 0, 1, 0, 0, 2, 2, 1, 0, 2, 1, 1, 1, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 2, 2, 0, 2, 2, 2, 0, 2, 1, 2, 0, 2, 0, 0, 0, 0, 2, 0, 0, 2, 2, 2, 2, 1, 0, 1, 2, 2, 1, 0, 1, 1, 2, 0, 1, 2, 0, 1, 1, 0, 0, 1, 1, 2, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 2, 2, 0, 1, 2, 1, 2, 0, 2, 0, 1, 0, 0, 1, 0, 1, 2, 2, 0, 1, 0, 1, 2, 2, 0, 1, 2, 0, 0, 1, 0, 1, 1, 0, 0, 0, 2, 0, 2, 0, 1, 1, 2, 1, 0, 2, 2, 0, 1, 0, 1, 1, 2, 2, 1, 2, 1, 0, 2, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 2, 2, 0, 2, 0, 1, 0, 1, 0, 2, 0, 2, 2, 0, 1, 0, 2, 1, 2, 1, 2, 0, 0, 0, 2, 1, 1, 1, 2, 1, 1, 2, 0, 1, 1, 2, 0, 2, 0, 0, 0, 0, 0, 1, 1, 1, 2, 0, 1, 0, 1, 2, 1, 0, 0, 1, 1, 0, 1, 0, 2, 2, 1, 1, 1, 1, 1, 0, 2, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 2, 0, 1, 0, 0, 0, 1, 0, 2, 0, 2, 2, 1, 2, 1, 0, 0, 1, 2, 1, 0, 1, 2, 1, 2, 1, 1, 2, 2, 0, 0, 2, 1, 1, 0, 1, 1, 2, 1, 0, 0, 0, 1, 2, 1, 2, 2, 0, 0, 2, 2, 0, 0, 1, 2, 1, 1, 1, 0, 2, 1, 0, 0, 1, 0, 1, 0, 0, 0, 2, 0, 2, 1, 0, 2, 0, 0, 2, 0, 2, 1, 2, 0, 1, 1, 1, 2, 2, 2, 0, 1, 2, 1, 0, 0, 2, 2, 0, 2, 1, 2, 0, 2, 1, 0, 1, 1, 1, 1, 1, 0, 2, 1, 0, 1, 0, 2, 1, 0, 1, 1, 1, 2, 2, 2, 2, 0, 1, 2, 2, 2, 0, 0, 1, 1, 2, 2, 1, 0, 2, 2, 0, 1, 0, 2, 1, 1, 1, 1, 2, 1, 0, 1, 2, 1, 2, 1, 0, 2, 0, 2, 1, 1, 0, 1, 2, 1, 2, 1, 0, 2, 1, 0, 1, 2, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 2, 1, 0, 1, 1, 2, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 2, 1, 1, 1, 0, 0, 0, 0, 1, 2, 0, 1, 0, 2, 0, 2, 2, 2, 0, 2, 0, 2, 1, 2, 2, 2, 0, 2, 1, 0, 0, 0, 0, 2, 0, 0, 0, 1, 2, 2, 0, 2, 1, 0, 2, 1, 2, 0, 0, 1, 2, 0, 0, 1, 0, 0, 2, 0, 2, 1, 1, 2, 2, 2, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2];
//        var annotations = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        
        // 4OLI... weird colors
//        var pdb_file = 'pdbs/4OLI.pdb';
//        var annotations = 
//        [2, 1, 2, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 2, 1, 1, 0, 1, 1, 0, 2, 1, 1, 0, 2, 1, 2, 0, 1, 2, 1, 0, 2, 2, 0, 2, 0, 1, 1, 1, 1, 2, 2, 1, 1, 1, 2, 2, 0, 1, 1, 0, 1, 2, 2, 2, 0, 0, 1, 1, 2, 1, 1, 1, 0, 2, 2, 0, 0, 1, 1, 1, 1, 0, 0, 2, 2, 2, 1, 2, 1, 0, 0, 2, 1, 0, 0, 0, 2, 0, 2, 2, 0, 1, 2, 2, 1, 1, 0, 1, 1, 1, 2, 2, 0, 1, 0, 0, 2, 1, 2, 1, 0, 1, 0, 1, 0, 2, 0, 2, 0, 2, 2, 0, 1, 2, 0, 1, 2, 0, 1, 1, 0, 0, 2, 0, 1, 0, 0, 2, 2, 2, 0, 1, 1, 0, 2, 1, 0, 0, 2, 0, 2, 0, 2, 2, 0, 0, 1, 0, 2, 1, 1, 2, 2, 1, 2, 0, 1, 2, 2, 1, 1, 1, 2, 1, 2, 1, 0, 2, 0, 2, 2, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 2, 2, 0, 0, 0, 1, 2, 1, 0, 0, 2, 0, 1, 0, 2, 0, 2, 1, 1, 2, 0, 2, 0, 2, 0, 2, 1, 0, 0, 0, 2, 0, 2, 2, 1, 1, 1, 1, 2, 1, 1, 2, 1, 2, 0, 2, 1, 2, 1, 2, 1, 2, 1, 1, 0, 0, 0, 0, 2, 2, 2, 0, 0, 2, 2, 0, 0, 2, 0, 1, 2, 0, 0, 1, 0, 1, 1, 0, 2, 1, 0, 0, 0, 2, 2, 1, 2, 1, 0, 0, 0, 0, 0, 0, 0, 2, 1, 0, 0, 2, 2, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 0, 2, 2, 0, 2, 2, 1, 2, 1, 1, 0, 2, 2, 0, 1, 1, 2, 1, 2, 1, 2, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 2, 2, 0, 0, 1, 2, 1, 0, 2, 2, 0, 2, 2, 1, 1, 1, 1, 2, 2, 0, 2, 0, 0, 0, 0, 2, 1, 1, 2, 1, 1, 0, 2, 1, 0, 0, 1, 0, 2, 2, 2, 1, 0, 0, 0, 1, 2, 1, 0, 1, 2, 2, 0, 1, 0, 2, 0, 2, 0, 2, 2, 1, 2, 1, 2, 2, 0, 2, 0, 2, 1, 1, 1, 2, 0, 2, 0, 2, 0, 2, 2, 2, 0, 2, 1, 2, 0, 2, 0, 1, 0, 2, 0, 1, 1, 1, 0, 1, 1, 2, 0, 2, 0, 0, 0, 2, 0, 2, 1, 2, 2, 1, 2, 2, 0, 2, 0, 1, 0, 0, 0, 2, 2, 1, 2, 1, 2, 1, 1, 0, 1, 1, 1, 0, 2, 2, 0, 0, 0, 2, 0, 0, 1, 0, 0, 2, 1, 2, 0, 1, 2, 0, 1, 0, 2, 2, 0, 0, 2, 0, 0, 1, 2, 0, 0, 0, 2, 2, 1, 0, 1, 0, 0, 2, 0, 2, 0, 0, 0, 0, 2, 2, 0, 2, 1, 2, 1, 0, 0, 0, 0, 0, 2, 2, 1, 2, 2, 0, 2, 0, 2, 2, 2, 2, 1, 0, 1, 1, 0, 1, 1, 2, 2, 0, 1, 2, 0, 1, 2, 2, 0, 1, 1, 1, 2, 2, 0, 0, 0, 1, 2, 0, 1, 2, 1, 2, 0, 0, 1, 2, 2, 0, 0, 2, 1, 0, 1, 2, 0, 1, 2, 1, 1, 0, 2, 1, 2, 2, 0, 0, 1, 0, 2, 0, 0, 0, 2, 2, 1, 0, 2, 1, 0, 1, 2, 2, 1, 1, 2, 1, 0, 0, 0, 1, 1, 2, 1, 2, 2, 0, 1, 2, 0, 2, 2, 2, 0, 1, 0, 1, 1, 2, 1, 1, 1, 0, 1];
//        var annotations = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        
        var parent = document.getElementById('viewer');
        var viewer = pv.Viewer(parent, options);
        
        var prevPicked = null;
        function setColorForAtom(go, atom, color){
            var view = go.structure().createEmptyView();
            view.addAtom(atom);
            go.colorBy(pv.color.uniform(color), view);
        }
        parent.addEventListener('mousemove', function(event){
          var rect = viewer.boundingClientRect();
          var picked = viewer.pick({ x : event.clientX - rect.left,
                y : event.clientY - rect.top });
          if (prevPicked !== null && picked !== null &&
            picked.target() === prevPicked.atom){
            return;
          }
          if (prevPicked !== null){
            setColorForAtom(prevPicked.node, prevPicked.atom, prevPicked.color);
          }
          if (picked !== null){
            var atom = picked.target();
            var index = atom.residue().num();
            document.getElementById('changes').innerHTML = atom.qualifiedName()+', index '+(index-magic_number);
            var color = [0,0,0,0];
            picked.node().getColorForAtom(atom, color);
            prevPicked = { atom : atom, color : color, node : picked.node() };
            setColorForAtom(picked.node(), atom, 'green');
          }
          else{
            document.getElementById('changes').innerHTML = '&nbsp;';
            prevPicked = null;
          }
          viewer.requestRedraw();
        });
        
        function color_substitutions() {
            return new pv.color.ColorOp(function(atom, out, index) {
                var resnum = atom.residue().num()-magic_number;
                annotation = annotations[resnum]
                if (annotation == 2) {
                    out[index+0] = 1.0; out[index+1] = 0.0;
                    out[index+2] = 0.0; out[index+3] = 1.0;
                } else if (annotation == 1) {
                    out[index+0] = 0.4; out[index+1] = 0.4;
                    out[index+2] = 0.4; out[index+3] = 1.0;
                } else {
                    console.log(resnum)
                    out[index+0] = 1.0; out[index+1] = 1.0;
                    out[index+2] = 1.0; out[index+3] = 1.0;
                }
            });
        }

        function loadSamplePDB() {
            pv.io.fetchPdb(pdb_file, function(structure) {
//                Select chain
                var chain = structure.select({chain: 'A'})
                viewer.on('viewerReady', function() {
                viewer.cartoon('protein', chain, { color: color_substitutions() });
//                sideChain = chain.select({rindices: indices})
//                viewer.ballsAndSticks('sideChain', sideChain);
                
//                Select entire structure                
//                viewer.on('viewerReady', function() {
//                viewer.cartoon('protein', structure, { color: color_substitutions() });
//                viewer.fitTo(chain);
                viewer.autoZoom();
              });
            });
        }

        document.addEventListener('DOMContentLoaded', loadSamplePDB);
    </script>
</body>
</html>